<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles -->
    <link href="{{ url_for('static', filename='daphne_theme.css') }}" rel="stylesheet">
    <title>Overview</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
</head>

<body>

{% include 'navbar.html' %}

<div class="container mt-4">

<!--    important: add option to visualize figure before or after IFAC-->

<div class="card my-4">
    <div class="card-header text-center">
            <h5> Overview of the Dataset </h5>
        </div>
        <div class="card-body">
        <div class="row align-items-center">

            <div class="col-md-6">
              <!-- Left Column -->
            <div class="d-flex justify-content-center mb-4">
                <select name="visualization-choice" id="visualization-choice" class="form-select form-select-lg" style="width: auto; min-width: 300px; background-color: #F8F8F8;">
                        <option value="Original Decisions" selected>Original Decisions</option>
                        <option value="Decisions after IFAC">Decisions after IFAC</option>
                </select>
            </div>
            <div class="d-flex justify-content-center">
            <canvas id="barChart" width="450" height="200"></canvas>

                <script>
                  const labels = {{ labels | safe }};
                  const datasets = {
                    "Decisions after IFAC": {{ new_pos_ratios | safe }},
                    "Original Decisions": {{ org_pos_ratios | safe }}
                  };

                  const ctx = document.getElementById("barChart").getContext("2d");
                  let chart = new Chart(ctx, {
                    type: "bar",
                    data: {
                      labels: labels,
                      datasets: [{
                        label: "Positive Decision Ratio",
                        data: datasets["Original Decisions"], // initial value
                        backgroundColor: "rgb(255, 193, 7)",
                        lineTension: 0.1
                      }]
                    },
                    options: {
                      responsive: true,
                      scales: {
                            yAxes: [{
                                ticks: {
                                    min: 0,
                                    max: 1
                                }
                            }]
                        }
                    }
                  });

                  document.getElementById("visualization-choice").addEventListener("change", function () {
                    const selected = this.value;
                    let values = datasets[selected] || datasets["Other"];


                    // Update chart data
                    chart.data.datasets[0].data = values;
                    chart.update();
                  });
                </script>

            </div>
            </div>
    <!-- Right Column -->
      <div class="col-md-6">
    <div class="card mb-3 text-center">
        <div class="d-flex align-items-center justify-content-center">
            <img src="{{ url_for('static', filename='n_people.png') }}" alt="N People" width="30">
            <b class="ms-2">Number of people </b> = {{ n_total }}
        </div>
        <div class="d-flex align-items-center justify-content-center">
            <img src="{{ url_for('static', filename='pos.png') }}" alt="Positive Decision Ratio" width="30">
            <b class="ms-2">Overall positive decision rate </b> = {{ average_pos_ratio | round(2) }}
        </div>
        <br>
        <p> To restore <strong> demographic parity </strong> and have an equal positive decision rate of <i> {{ average_pos_ratio | round(2) }} </i> for each
        demographic group IFAC needs to execute this number of <strong>rejects/flips</strong>: </p>
        <br>
        <div class="d-flex align-items-center justify-content-center">
            <img src="{{ url_for('static', filename='flipped.png') }}" alt="Flipped" width="30">
            <b class="ms-2">Total number of flips </b> = {{ n_total_flipped }}
        </div>
        <div class="d-flex align-items-center justify-content-center">
            <img src="{{ url_for('static', filename='deferred.png') }}" alt="Rejected" width="30">
            <b class="ms-2">Total number of rejects </b>  = {{ n_total_rejected }}
        </div>
    </div>
</div>
    </div>
        </div>
</div>


<div class="alert alert-warning" role="alert">
  <h5> <center> Demographic Groups at Risk of Favouritism </center> </h5>
</div>

{% for pd_itemset in unique_pd_itemsets %}
    {% if pd_itemset_is_discriminated_info[pd_itemset] == False %}
    <div class="card my-4">
    <div class="card-header text-center">
        <h3>
            <a href="{{ url_for('inspect_one_demographic_group', pd_itemset=pd_itemset, pd_itemset_in_html=pd_itemset_html_dict[pd_itemset], pos_ratio_pd_itemset = pd_itemset_pos_ratio[pd_itemset] , n_pd_itemset = pd_itemset_n[pd_itemset], n_flipped = pd_itemset_flipped_info[pd_itemset], n_rejected = pd_itemset_reject_info[pd_itemset]) }}" style="color:black;">
                {{ pd_itemset_html_dict[pd_itemset] }}
            </a>
        </h3>
        <br>
        <!-- Wrap both flex elements inside a parent flex container -->
        <div style="display: flex; justify-content: center; gap: 30px;">
            <!-- First image-text pair -->
            <div style="display: inline-flex; align-items: center; gap: 10px;">
                <img src="{{ url_for('static', filename='n_people.png') }}" alt="N People" width="30">
                <span> <b> Number of people </b>  = {{ pd_itemset_n[pd_itemset] }}</span>
            </div>

            <!-- Second image-text pair -->
            <div style="display: inline-flex; align-items: center; gap: 10px;">
                <img src="{{ url_for('static', filename='pos.png') }}" alt="Positive Decision Ratio" width="30">
                <span> <b> Positive Decision Ratio </b> = {{ pd_itemset_pos_ratio[pd_itemset] }}</span>
            </div>
        </div>

        <div style="display: flex; justify-content: center; gap: 30px;">
            <!-- Third image-text pair -->
            <div style="display: inline-flex; align-items: center; gap: 10px;">
                <img src="{{ url_for('static', filename='flipped.png') }}" alt="Flipped" width="30">
                <span> <b> Number of flipped decisions  </b>  = {{ pd_itemset_flipped_info[pd_itemset] }}</span>
            </div>

            <!-- Fourth image-text pair -->
            <div style="display: inline-flex; align-items: center; gap: 10px;">
                <img src="{{ url_for('static', filename='deferred.png') }}" alt="Rejected" width="30">
                <span> <b> Number of rejected decisions  </b>  = {{ pd_itemset_reject_info[pd_itemset] }}</span>
            </div>

        </div>
    </div>
        </div>
    {% endif %}
    {% endfor %}



<div class="alert alert-warning" role="alert">
  <h5> <center> Demographic Groups at Risk of Discrimination </center> </h5>
</div>


{% for pd_itemset in unique_pd_itemsets %}
    {% if pd_itemset_is_discriminated_info[pd_itemset] %}
    <div class="card my-4">
    <div class="card-header text-center">
        <h3>
            <a href="{{ url_for('inspect_one_demographic_group', pd_itemset=pd_itemset, pd_itemset_in_html=pd_itemset_html_dict[pd_itemset], pos_ratio_pd_itemset = pd_itemset_pos_ratio[pd_itemset] , n_pd_itemset = pd_itemset_n[pd_itemset], n_flipped = pd_itemset_flipped_info[pd_itemset], n_rejected = pd_itemset_reject_info[pd_itemset]) }}" style="color:black;">
                {{ pd_itemset_html_dict[pd_itemset] }}
            </a>
        </h3>
        <br>
        <!-- Wrap both flex elements inside a parent flex container -->
        <div style="display: flex; justify-content: center; gap: 30px;">
            <!-- First image-text pair -->
            <div style="display: inline-flex; align-items: center; gap: 10px;">
                <img src="{{ url_for('static', filename='n_people.png') }}" alt="N People" width="30">
                <span> <b> Number of people </b>  = {{ pd_itemset_n[pd_itemset] }}</span>
            </div>

            <!-- Second image-text pair -->
            <div style="display: inline-flex; align-items: center; gap: 10px;">
                <img src="{{ url_for('static', filename='pos.png') }}" alt="Positive Decision Ratio" width="30">
                <span> <b> Positive Decision Ratio </b> = {{ pd_itemset_pos_ratio[pd_itemset] }}</span>
            </div>
        </div>

        <div style="display: flex; justify-content: center; gap: 30px;">
            <!-- Third image-text pair -->
            <div style="display: inline-flex; align-items: center; gap: 10px;">
                <img src="{{ url_for('static', filename='flipped.png') }}" alt="Flipped" width="30">
                <span> <b> Number of flipped decisions  </b>  = {{ pd_itemset_flipped_info[pd_itemset] }}</span>
            </div>

            <!-- Fourth image-text pair -->
            <div style="display: inline-flex; align-items: center; gap: 10px;">
                <img src="{{ url_for('static', filename='deferred.png') }}" alt="Rejected" width="30">
                <span> <b> Number of rejected decisions  </b>  = {{ pd_itemset_reject_info[pd_itemset] }}</span>
            </div>

        </div>
    </div>
        </div>
    {% endif %}
    {% endfor %}

</div>

</body>
</html>